<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Fourier Draw</title>
    </head>

    <body>
        <div id="container" style="border: 2px solid; width: 90vw; height: 80vh; cursor: crosshair; margin-left: 3vw;">
            <canvas id="canvas2" style="position:absolute"></canvas>
            <canvas id="canvas" style="position:absolute"></canvas>
        </div>
    </body>
    <button onclick="clearStuffs()">Clear Shits</button>
    <button onclick="listFourier()">Calculate Fourier Coefficients</button>
    <button onclick="listFourierValues()">Fourier Values</button>
    <button onclick="drawCircles()">Nothing</button>
    <div class="slidecontainer">
        <p>Precision</p>
        <input type="range" min="0" max="100" value="100" class="slider" id="slider" style="width:80vw">
        <div id="cValue">n circles</div>
    </div>
    <table id="table"></table>
    <script>
        var container = document.getElementById("container");
        var slider = document.getElementById("slider");
        var sliderValue = document.getElementById("cValue");
        var c = document.getElementById("canvas");
        c.width = parseInt(getComputedStyle(container).width.replace("px", ""));
        c.height = parseInt(getComputedStyle(container).height.replace("px", ""));
        var ctx = c.getContext("2d");
        var boundingRect = c.getBoundingClientRect();
        var c2 = document.getElementById("canvas2");
        c2.width = c.width;
        c2.height = c.height;
        var ctx2 = c2.getContext("2d");

        var initialPos;
        var points = [];

        var point = function (x, y) {
            this.x = x;
            this.y = y;
        };
        var complexNumber = function (Re, Im) {
            this.Re = Re;
            this.Im = Im;
        };
        var FourierCoefficients = [],
            FourierValues = [];
        var prevPoint, nowPoint;
        var mouseClicked = false
        c.onmousedown = function (e) {
            clearStuffs();
            document.body.style.overflow = "hidden"
            mouseClicked = true
            ctx.lineWidth = 3;
            console.log(e)
            initialPos = new point((e.x) ? (e.pageX - boundingRect.left) : (e.touches[0].pageX - boundingRect
                .left), (e.y) ? (e.pageY - boundingRect.top) : (e.touches[0].pageY - boundingRect
                .left));
            points.push(initialPos);
            ctx.lineStyle = "#000";
            ctx.moveTo(initialPos.x, initialPos.y);
        };
        c.onmousemove = function (e) {
            if (mouseClicked) {
                newPoint = new point((e.pageX) ? (e.pageX - boundingRect.left) : (e.touches[0].pageX - boundingRect
                    .left), (e.pageY) ? (e.pageY - boundingRect.top) : (e.touches[0].pageY - boundingRect
                    .left));
                ctx.lineTo(newPoint.x, newPoint.y);
                if (!prevPoint) prevPoint = initialPos;
                var distance = Math.hypot(prevPoint.x - newPoint.x, prevPoint.y - newPoint.y)
                if (distance > 10) {
                    points.push(newPoint);
                    prevPoint = newPoint;
                }
                ctx.stroke();
            }
        };
        c.ontouchstart = c.onmousedown;
        c.ontouchmove = c.onmousemove;
        c.onmouseup = function (e) {
            document.body.style.overflow = "auto"
            points.push(initialPos);
            ctx.stroke();
            ctx.closePath();
            clearCanvas();
            drawBezier(points, "black")
            listValues(points);
            mouseClicked = false
        };
        c.ontouchend = c.onmouseup;

        function clearStuffs() {
            points = [];
            listValues(null);
            ctx.beginPath();
            ctx.clearRect(0, 0, c.width, c.height);
        }

        function clearCanvas() {
            ctx.beginPath();
            ctx.clearRect(0, 0, c.width, c.height);
        }

        function fourierTransform(pointArr) {
            var fourierCoefficients = [];
            var N = pointArr.length - 1;
            for (var j = 0; j < pointArr.length - 1; j++) {
                var Re_NF_j = 0,
                    Im_NF_j = 0;
                for (var k = 0; k < pointArr.length - 1; k++) {
                    var theta = -(2 * Math.PI * k * j) / N;
                    Re_NF_j +=
                        Math.cos(theta) * pointArr[k].x - Math.sin(theta) * pointArr[k].y;
                    Im_NF_j +=
                        Math.cos(theta) * pointArr[k].y + Math.sin(theta) * pointArr[k].x;
                }
                fourierCoefficients.push(new complexNumber(Re_NF_j / N, Im_NF_j / N));
            }
            return fourierCoefficients;
        }

        function listFourier() {
            var fourierCoefficients = fourierTransform(points);
            FourierCoefficients = fourierCoefficients;
            var table = document.getElementById("table");
            table.innerHTML = `<thead><tr><td>Fourier Coefficients</td></tr></thead>`;
            if (fourierCoefficients)
                for (var i = 0; i < fourierCoefficients.length; i++)
                    table.innerHTML +=
                    `<tr><td>${i + 1}</td><td>${fourierCoefficients[i].Re}</td><td>${fourierCoefficients[i].Im}</td></tr>`;
        }

        function fourierDraw(fourierCoefficients, PrecisionCount) {
            var fourierValues = [];
            var N = fourierCoefficients.length;
            var precisionCount = PrecisionCount || N;
            for (var j = 0; j < fourierCoefficients.length; j++) {
                var Re_NF_j = 0,
                    Im_NF_j = 0,
                    firstx,
                    firsty, k;
                for (var i = 0; i < (precisionCount); i++) {
                    if (i % 2 == 0)
                        k = i / 2;
                    else k = N - Math.ceil(i / 2)
                    var theta = (2 * Math.PI * k * j) / N;
                    Re_NF_j +=
                        Math.cos(theta) * fourierCoefficients[k].Re -
                        Math.sin(theta) * fourierCoefficients[k].Im;
                    Im_NF_j +=
                        Math.cos(theta) * fourierCoefficients[k].Im +
                        Math.sin(theta) * fourierCoefficients[k].Re;
                }
                fourierValues.push(new point(Re_NF_j, Im_NF_j));
                if (j == 0) {
                    firstx = Re_NF_j;
                    firsty = Im_NF_j;
                }
            }
            fourierValues.push(new point(firstx, firsty));
            return fourierValues;
        }

        function listFourierValues() {
            if (FourierCoefficients.length === 0) FourierCoefficients = fourierTransform(points)
            FourierValues = fourierDraw(FourierCoefficients);
            listValues(FourierValues);
            drawPoints(FourierValues);
            slider.max = FourierValues.length;
            slider.value = FourierValues.length;
            sliderValue.innerHTML = (`${slider.value-1} circles`)
            slider.oninput = function () {
                clearCanvas()
                drawBezier(points, "black")
                drawBezier(fourierDraw(FourierCoefficients, this.value), "blue")
                sliderValue.innerHTML = (`${this.value-1} circles`)
            }
            slider.oninput = function () {
                clearCanvas()
                drawBezier(points, "black")
                drawBezier(fourierDraw(FourierCoefficients, this.value), "blue")
                sliderValue.innerHTML = (`${this.value-1} circles`)
            }
        }

        // function drawCircles(precisionCount) {
        //     for (var j = 0; j < FourierCoefficients.length; j++) {
        //         for (var i = 0; i < (precisionCount); i++) {
        //             if (i % 2 == 0)
        //                 k = i / 2;
        //             else k = N - Math.ceil(i / 2)
        //             var theta = (2 * Math.PI * k * j) / N;
        //             Re_NF_j +=
        //                 Math.cos(theta) * fourierCoefficients[k].Re -
        //                 Math.sin(theta) * fourierCoefficients[k].Im;
        //             Im_NF_j +=
        //                 Math.cos(theta) * fourierCoefficients[k].Im +
        //                 Math.sin(theta) * fourierCoefficients[k].Re;
        //         }
        //         fourierValues.push(new point(Re_NF_j, Im_NF_j));
        //         if (j == 0) {
        //             firstx = Re_NF_j;
        //             firsty = Im_NF_j;
        //         }
        //     }
        // }

        function drawCircles() {
            var i = 0;
            ctx2.beginPath()
            ctx2.clearRect(0, 0, c2.width, c2.height)
            ctx2.arc(FourierCoefficients[0].Re, FourierCoefficients[0].Im, Math.hypot(FourierCoefficients[1].Re,
                FourierCoefficients[1].Im), 0, 2 * Math.PI)
            ctx2.stroke()
            i++;
        }

        function drawPoints(pointArr, color) {
            ctx.strokeStyle = color || "blue";
            ctx.beginPath();
            ctx.moveTo(pointArr[0].x, pointArr[0].y);
            for (var i = 1; i < pointArr.length; i++) {
                ctx.lineTo(pointArr[i].x, pointArr[i].y);
            }
            ctx.stroke();
            ctx.closePath();
        }

        function drawBezier(pointArr, color) {
            ctx.strokeStyle = color || "blue";
            ctx.beginPath();
            ctx.moveTo(pointArr[0].x, pointArr[0].y);
            for (var i = 0; i < pointArr.length - 1; i++) {
                ctx.quadraticCurveTo(pointArr[i].x, pointArr[i].y, pointArr[i + 1].x, pointArr[i + 1].y)
                ctx.moveTo(pointArr[i + 1].x, pointArr[i + 1].y);
            }
            ctx.stroke();
            ctx.closePath();
        }

        function listValues(pointArr) {
            var table = document.getElementById("table");
            table.innerHTML = `<thead><tr><td>Points (x,y)</td></tr></thead>`;
            if (pointArr)
                for (var i = 0; i < pointArr.length; i++)
                    table.innerHTML += `<tr><td>${i + 1}</td><td>${pointArr[i].x}</td><td>${pointArr[i].y}</td></tr>`;
        }
    </script>

</html>